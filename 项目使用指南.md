# 句子嵌入系统使用指南

## 📋 项目简介

这是一个基于 `all-MiniLM-L6-v2` 模型的智能句子嵌入和相似性搜索系统，支持批量处理Markdown文档，构建高效的语义搜索索引，并提供直观的Web界面进行文档检索。

## 🚀 快速启动

### 方法一：Web界面启动（推荐）

1. **打开终端并进入项目目录**
   ```bash
   cd sentence_embedding_system
   ```

2. **激活Python虚拟环境**
   ```bash
   # Windows
   .\venv\Scripts\activate
   
   # Linux/Mac
   source venv/bin/activate
   ```

3. **启动Web应用**
   ```bash
   python app.py
   ```

4. **访问Web界面**
   - 打开浏览器访问：`http://127.0.0.1:5000`
   - 系统会自动初始化并扫描 `init_files/literature_standard` 目录
   - 首次启动会自动构建索引（可能需要几分钟）

### 方法二：命令行工具

```bash
# 激活虚拟环境
.\venv\Scripts\activate

# 使用命令行工具
python main.py --help
```

## 🛠️ 环境配置

### 系统要求
- **Python**: 3.8 或更高版本
- **操作系统**: Windows 10/11, Linux, macOS
- **内存**: 建议 4GB 以上
- **存储**: 至少 2GB 可用空间

### 依赖包安装

项目已配置独立的虚拟环境，包含以下主要依赖：

```
sentence-transformers  # 句子嵌入模型
torch                 # PyTorch深度学习框架
numpy                 # 数值计算
pandas                # 数据处理
scikit-learn         # 机器学习工具
faiss-cpu            # 高效相似性搜索
tqdm                 # 进度条显示
click                # 命令行界面
flask                # Web框架
werkzeug             # WSGI工具
```

如需重新安装依赖：
```bash
pip install -r requirements.txt
```

## 📁 项目结构

```
sentence_embedding_system/
├── 📁 venv/                     # Python虚拟环境
├── 📁 init_files/               # 初始化文件目录
│   ├── 📁 demo/                 # 演示文件
│   └── 📁 literature_standard/  # 标准文献文件（自动扫描）
├── 📁 templates/                # Web模板
│   └── index.html              # 主页面模板
├── 📁 uploads/                  # 文件上传目录
├── 📄 app.py                   # Web应用主程序
├── 📄 main.py                  # 命令行工具
├── 📄 database.py              # 数据库管理
├── 📄 embedding_processor.py   # 嵌入处理器
├── 📄 search_index.py          # 搜索索引
├── 📄 requirements.txt         # 依赖列表
├── 📄 embeddings.db           # SQLite数据库（自动生成）
├── 📄 similarity_index.faiss  # FAISS索引文件（自动生成）
└── 📄 embedding_system.log    # 系统日志（自动生成）
```

## 🎯 功能特性

### 1. Web界面功能
- **📊 实时统计**: 显示数据库中的文档和句子数量
- **🔍 智能搜索**: 基于语义相似性的文档检索
- **📖 文档预览**: 点击搜索结果可预览完整Markdown文档
- **📁 文件管理**: 支持上传新的Markdown文档
- **🎨 响应式设计**: 适配不同屏幕尺寸的三栏布局

### 2. 命令行功能
- **批量处理**: 支持单文件和目录批量处理
- **索引构建**: 自动构建和更新FAISS索引
- **相似性搜索**: 命令行下的文档检索
- **统计分析**: 数据库和索引的详细统计

## 📖 使用方法

### Web界面使用

1. **启动系统**
   ```bash
   python app.py
   ```

2. **搜索文档**
   - 在搜索框中输入查询内容
   - 系统会返回语义相似的句子和对应文档
   - 点击"查看文件"按钮可预览完整文档

3. **上传文档**
   - 点击"选择文件"按钮
   - 选择Markdown文件（.md格式）
   - 系统会自动处理并添加到索引中

4. **查看统计**
   - 页面顶部显示当前数据库统计信息
   - 包括文档数量、句子数量等

### 命令行使用

1. **处理单个文件**
   ```bash
   python main.py process-files --file "path/to/document.md"
   ```

2. **批量处理目录**
   ```bash
   python main.py process-files --directory "path/to/documents/" --pattern "*.md"
   ```

3. **构建搜索索引**
   ```bash
   python main.py build-index
   ```

4. **搜索文档**
   ```bash
   python main.py search --query "您的搜索内容" --top-k 10
   ```

5. **查看统计信息**
   ```bash
   python main.py stats
   ```

## ⚙️ 配置选项

### 环境变量配置

可以通过环境变量自定义系统行为：

```bash
# 设置自动扫描目录
export AUTO_SCAN_DIRECTORY="./init_files/literature_standard"

# 设置是否自动构建索引
export AUTO_BUILD_INDEX="true"
```

### 命令行参数

```bash
# 查看所有可用参数
python main.py --help

# 常用参数示例
python main.py process-files \
  --directory "./documents" \
  --pattern "*.md" \
  --batch-size 32 \
  --model "all-MiniLM-L6-v2" \
  --database "embeddings.db"
```

## 🔧 故障排除

### 常见问题

1. **启动失败**
   - 检查Python版本是否为3.8+
   - 确认虚拟环境已激活
   - 验证所有依赖包已安装

2. **内存不足**
   - 减少batch_size参数
   - 关闭其他占用内存的程序
   - 考虑分批处理大量文档

3. **索引构建缓慢**
   - 首次运行需要下载模型，请耐心等待
   - 大量文档处理需要时间，可查看日志了解进度

4. **搜索结果不准确**
   - 确保文档已正确处理并添加到索引
   - 尝试使用更具体的搜索词
   - 检查文档内容是否符合预期格式

### 日志查看

系统会自动生成日志文件 `embedding_system.log`，包含详细的运行信息：

```bash
# 查看最新日志
tail -f embedding_system.log

# 搜索错误信息
grep "ERROR" embedding_system.log
```

## 📊 性能优化

### 批处理优化
- **batch_size**: 根据内存大小调整（推荐16-64）
- **并行处理**: 系统自动利用多核CPU
- **内存管理**: 大文件会自动分批处理

### 搜索优化
- **索引更新**: 添加新文档后会自动更新索引
- **缓存机制**: 重复搜索会利用缓存加速
- **结果排序**: 按相似度自动排序

## 🔒 安全注意事项

1. **文件上传**: 仅支持.md和.txt格式文件
2. **文件大小**: 限制单文件最大16MB
3. **路径安全**: 自动处理文件名安全性
4. **数据隐私**: 所有数据存储在本地

## 📞 技术支持

如遇到问题，请：

1. 查看 `embedding_system.log` 日志文件
2. 检查终端输出的错误信息
3. 确认文件格式和路径正确性
4. 验证系统资源是否充足

## 🎉 开始使用

现在您可以开始使用这个强大的句子嵌入系统了！

```bash
# 快速启动
cd sentence_embedding_system
.\venv\Scripts\activate
python app.py
```

然后在浏览器中访问 `http://127.0.0.1:5000` 开始您的智能文档搜索之旅！